<ul
  class="filter"
  *ngIf="form && group && !state.disabled"
  [formGroup]="form"
  (clickOutside)="hide()"
>
  <li>
    <a
      (click)="toggle()"
      class="filter-opener"
      [ngClass]="{
        open: state.visible
      }"
    >
      <ng-container *ngIf="getSetCheckboxValues(group) as setVals">
        <span class="selection">
          {{ setVals }}
        </span>
      </ng-container>
      <span class="opener-name">
        {{ group | renameApiFacet }}
      </span>
    </a>
  </li>

  <ng-template #dates>
    <li>
      <app-dates [form]="form" (valueChanged)="changed()"></app-dates>
    </li>
  </ng-template>

  <ng-container *ngIf="state.visible">
    <ng-container *ngIf="_options; else dates">
      <li class="checkboxes">
        <ul>
          <li class="checkbox-filter">
            <span class="icon"></span>
            <input
              class="checkbox-filter-input"
              (keyup)="filterOptions($event)"
              placeholder="Search"
            />
          </li>
        </ul>
        <ul class="checkboxes-list">
          <li>
            <ul
              *ngFor="let option of filteredOptions; let i = index"
              [formGroupName]="group"
              class="checkbox-labelled"
            >
              <li
                class="checkmarked-checkbox"
                [ngClass]="{
                  checked: form.value[group][option.name]
                }"
              >
                <input
                  id="add_filter_{{ group }}_{{ i }}"
                  class="checkbox"
                  data-e2e="cb-filter"
                  type="checkbox"
                  (change)="changed()"
                  [value]="option.name"
                  [formControlName]="option.name"
                  [attr.disabled]="
                    !selectOptionEnabled(group, option.name) ? true : null
                  "
                />
              </li>
              <li>
                <label
                  class="filter-label"
                  for="add_filter_{{ group }}_{{ i }}"
                >
                  {{ option.label | renameRights }}
                </label>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ng-container>
  </ng-container>
</ul>
