<div *ngIf="gridRows">
  <ng-template #linkOut let-row="row" let-total="row.isTotal">
    <span class="cell-link-out" [ngClass]="{ highlight: row.highlight }">
      <a
        target="_blank"
        class="link-out"
        [href]="getUrlRow(total ? null : row.name)"
      ></a>
    </span>
  </ng-template>

  <ng-template #seriesColour let-row="row">
    <span
      class="series-colour"
      [ngStyle]="{
        backgroundColor: colours[row['colourIndex']]
      }"
    ></span>
  </ng-template>

  <div class="data-grid" [ngClass]="{ 'with-series': showingSeriesInfo }">
    <span class="cell-wide search-control container-h">
      <span class="search-icon"></span>
      <input
        class="search"
        placeholder="Search..."
        [(ngModel)]="filterString"
        (keyup)="updateRows()"
      />
    </span>

    <span class="navigation-controls container-h">
      <span *ngIf="pagerInfo && pagerInfo.pageCount > 1" class="container-h">
        <span>Rows per page:</span>
        <select class="max-page-size" [(ngModel)]="maxPageSize">
          <option *ngFor="let mps of maxPageSizes" [ngValue]="mps.value">
            {{ mps.title }}
          </option>
        </select>
        <span>Go to:</span>
        <input
          pattern="[0-9]+"
          class="go-to"
          (keyup)="goToPage($event)"
          placeholder="{{ pagerInfo.currentPage + 1 }}"
        />
      </span>

      <app-grid-paginator
        #paginator
        [maxPageSize]="maxPageSize"
        [rows]="gridRows"
        (change)="setPagerInfo($event)"
      ></app-grid-paginator>
    </span>

    <span class="cell-header cell-wide">
      {{ title }}
    </span>

    <span
      class="cell-header text-right"
      data-e2e="grid-sort-count"
      [ngClass]="{
        active: sortStates['count'] !== 0,
        descending: sortStates['count'] === -1
      }"
      ><a (click)="sort('count')">Count</a></span
    >

    <span
      class="cell-header text-right"
      [ngClass]="{
        active: sortStates['percent'] !== 0,
        descending: sortStates['percent'] === -1
      }"
      ><a (click)="sort('percent')">Percent</a></span
    >

    <span class="cell-header">View in Europeana</span>

    <ng-container *ngIf="pagerInfo">
      <!-- Summary rows -->

      <ng-container *ngFor="let row of summaryRows">
        <span class="cell-summary-name cell-wide">
          <span class="container-h" style="background: pink; min-width: 0">
            <ng-content
              *ngTemplateOutlet="seriesColour; context: { row: row }"
            ></ng-content>
            <!--
          <app-truncate [text]="row.series"></app-truncate>
          -->
            {{ row.series }}
          </span>
        </span>
        <span class="text-right">
          {{ row.count }}
        </span>
        <span class="text-right"> {{ row.percent }}% </span>

        <ng-content
          *ngTemplateOutlet="linkOut; context: { row: row }"
        ></ng-content>
      </ng-container>

      <!-- Rows -->

      <ng-container *ngFor="let row of pagerInfo.pageRows; let i = index">
        <span
          class="cell-name"
          [ngClass]="{ highlight: row.highlight }"
          data-e2e="grid-row-name"
          [title]="row.name"
        >
          <app-truncate [text]="row.name"></app-truncate>
        </span>

        <span
          *ngIf="showingSeriesInfo"
          class="cell-series container-h"
          [ngClass]="{ highlight: row.highlight }"
        >
          <ng-content
            *ngTemplateOutlet="seriesColour; context: { row: row }"
          ></ng-content>
          <!--
          <span class="series-info" [title]="row.series">
            {{ row.series }}
          </span>
          -->
        </span>

        <span
          class="text-right"
          [ngClass]="{
            highlight: row.highlight,
            bold: row.isTotal
          }"
        >
          {{ row.count }}
        </span>

        <span class="text-right" [ngClass]="{ highlight: row.highlight }">
          {{ row.percent }}%
        </span>

        <ng-content
          *ngTemplateOutlet="linkOut; context: { row: row }"
        ></ng-content>
      </ng-container>
    </ng-container>
  </div>
</div>
